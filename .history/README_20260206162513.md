# Controle Parental Windows 11

Sistema de controle parental que monitora tempo de uso do PC e bloqueia/desloga automaticamente ao atingir o limite configurado.

## üì¶ Instala√ß√£o R√°pida

### Op√ß√£o 1: Instalador Autom√°tico (Recomendado)

1. **Baixe o instalador** da [p√°gina de releases](https://github.com/farukzahra/parentalcontrol/releases)
2. **Execute** `ParentalControl-Setup-1.0.0.exe` como Administrador
3. **Siga** o assistente de instala√ß√£o
4. **Configure** usando o aplicativo no Menu Iniciar

### Op√ß√£o 2: Instala√ß√£o Manual (Sem Inno Setup)

```powershell
# Execute como Administrador
cd c:\repo\parentalControl
.\Install-Manual.ps1
```

### Op√ß√£o 3: Build do Instalador (Desenvolvedores)

**Requisitos:**
- [Inno Setup 6](https://jrsoftware.org/isdl.php) instalado
- .NET 8 SDK

```powershell
# Compilar e criar instalador
.\Build-Installer.ps1

# O instalador ser√° gerado em: .\Installer\ParentalControl-Setup-1.0.0.exe
```

## üöÄ Uso

1. **Abra** "Controle Parental" no Menu Iniciar
2. **Configure** o tempo limite desejado (15 min a 8 horas)
3. **Escolha** a a√ß√£o: Bloquear tela ou Fazer logout
4. **Salve** a configura√ß√£o (requer senha de admin)
5. O servi√ßo come√ßar√° a monitorar automaticamente!

## üóëÔ∏è Desinstala√ß√£o

### Via Instalador
- Painel de Controle ‚Üí Programas ‚Üí Desinstalar "Controle Parental"

### Manual
```powershell
# Execute como Administrador
.\Uninstall-Manual.ps1
```

## Status do Projeto

‚úÖ **CONCLU√çDO**:
- Estrutura de solution .NET 8 com 4 projetos
- Biblioteca Core com modelos, comunica√ß√£o (Named Pipes) e seguran√ßa
- Windows Service protegido que monitora tempo de sess√£o
- Aplicativo WPF de configura√ß√£o completo
- Sistema de bloqueio autom√°tico via APIs do Windows
- Scripts de instala√ß√£o/desinstala√ß√£o
- Instalador profissional com Inno Setup

üöß **PENDENTE**:
- Agente de notifica√ß√µes Toast
- Prote√ß√£o avan√ßada contra encerramento do servi√ßo
- Hist√≥rico de uso e relat√≥rios

## Arquitetura

```
ParentalControl/
‚îú‚îÄ‚îÄ ParentalControl.Core/           ‚úÖ CONCLU√çDO
‚îÇ   ‚îú‚îÄ‚îÄ Models/                     - TimeLimit, SessionInfo, ServiceMessage
‚îÇ   ‚îú‚îÄ‚îÄ Communication/              - PipeServer, PipeClient (Named Pipes)
‚îÇ   ‚îî‚îÄ‚îÄ Security/                   - WindowsAuthenticator, SessionManager, ConfigManager
‚îÇ
‚îú‚îÄ‚îÄ ParentalControl.Service/        ‚úÖ CONCLU√çDO
‚îÇ   ‚îî‚îÄ‚îÄ ParentalControlWorker.cs    - Windows Service que monitora e aplica bloqueio
‚îÇ
‚îú‚îÄ‚îÄ ParentalControl.ConfigApp/      ‚úÖ CONCLU√çDO
‚îÇ   ‚îî‚îÄ‚îÄ Interface WPF para configura√ß√£o
‚îÇ
‚îî‚îÄ‚îÄ ParentalControl.NotificationAgent/  üöß PENDENTE
    ‚îî‚îÄ‚îÄ Agente para exibir Toast Notifications
```

## Funcionalidades Implementadas

### ‚úÖ Biblioteca Core (ParentalControl.Core)

**Modelos**:
- `TimeLimit`: Configura√ß√£o de tempo m√°ximo, a√ß√£o (Lock/Logout), avisos
- `SessionInfo`: Informa√ß√µes da sess√£o (usu√°rio, tempo decorrido, tempo restante)
- `ServiceMessage`: Mensagens entre servi√ßo e agente (avisos, status, tamper)

**Comunica√ß√£o**:
- `PipeServer`: Servidor Named Pipe para enviar mensagens do servi√ßo
- `PipeClient`: Cliente para receber mensagens no agente de notifica√ß√µes

**Seguran√ßa**:
- `WindowsAuthenticator`: Autentica√ß√£o com senha Windows via LogonUser API
- `WindowsSessionManager`: Bloqueio de tela (LockWorkStation) e logout (ExitWindowsEx)
- `ConfigurationManager`: Armazenamento de configura√ß√µes no Registry (HKLM)

### ‚úÖ Windows Service (ParentalControl.Service)

- **Monitoramento cont√≠nuo** do tempo desde o login
- **Avisos progressivos** aos 15, 10 e 5 minutos restantes
- **Bloqueio/Logout autom√°tico** quando tempo expirar
- **Logging** no Event Log do Windows
- **Comunica√ß√£o via Named Pipes** com agente de notifica√ß√µes
- **Prote√ß√£o**: Roda como SYSTEM, configura√ß√£o armazenada em HKLM

### ‚úÖ Aplicativo de Configura√ß√£o WPF (ParentalControl.ConfigApp)

- Interface gr√°fica moderna em portugu√™s
- Slider para configurar tempo (15 min a 8 horas)
- Presets r√°pidos (30min, 1h, 2h, 3h, 4h)
- Status em tempo real da sess√£o
- Verifica√ß√£o de privil√©gios de administrador
- Bot√£o de teste para validar bloqueio

## Pr√≥ximos Passos

### 1. Agente de Notifica√ß√µes (ParentalControl.NotificationAgent) - Alta prioridade
- Aplicativo leve que roda na sess√£o do usu√°rio
- Exibe Windows Toast Notifications
- Recebe mensagens do servi√ßo via Named Pipes
- Inicia automaticamente com o Windows

### 2. Prote√ß√µes Avan√ßadas - M√©dia prioridade
- ACLs mais restritivas no servi√ßo
- Prote√ß√£o contra Task Manager
- Monitoramento de tentativas de bypass

### 3. Funcionalidades Extras - Baixa prioridade
- Hist√≥rico de uso com gr√°ficos
- M√∫ltiplos perfis de usu√°rio
- Hor√°rios permitidos por dia da semana
- Envio de notifica√ß√µes por email

## üìã Requisitos de Sistema

- **SO:** Windows 10 ou 11 (64-bit)
- **Runtime:** .NET 8 Runtime (inclu√≠do no instalador)
- **Privil√©gios:** Administrador para instala√ß√£o
- **Conta:** Filho deve ser usu√°rio padr√£o (n√£o Administrator)

## ‚öôÔ∏è Configura√ß√µes

- Windows 11 (compat√≠vel com Windows 10)
- .NET 8 Runtime
- Privil√©gios de Administrador para instala√ß√£o
- Conta do filho deve ser **Usu√°rio Padr√£o** (n√£o Administrator)

## Configura√ß√µes Atuais

As configura√ß√µes s√£o armazenadas no Registry em:
```
HKEY_LOCAL_MACHINE\SOFTWARE\ParentalControl
```

**Valores**:
- `MaxMinutes` (DWORD): Tempo m√°ximo em minutos (padr√£o: 60)
- `IsEnabled` (DWORD): 1 = ativado, 0 = desativado (padr√£o: 1)
- `Action` (String): "Lock" ou "Logout" (padr√£o: "Lock")

Dados da sess√£o s√£o armazenados em:
```
HKEY_LOCAL_MACHINE\SOFTWARE\ParentalControl\SessionData
```

## ‚öôÔ∏è Configura√ß√µes

As configura√ß√µes s√£o armazenadas no Registry em:
```
HKEY_LOCAL_MACHINE\SOFTWARE\ParentalControl
```

**Valores**:
- `MaxMinutes` (DWORD): Tempo m√°ximo em minutos (padr√£o: 60)
- `IsEnabled` (DWORD): 1 = ativado, 0 = desativado (padr√£o: 1)
- `Action` (String): "Lock" ou "Logout" (padr√£o: "Lock")

Dados da sess√£o s√£o armazenados em:
```
HKEY_LOCAL_MACHINE\SOFTWARE\ParentalControl\SessionData
```

## üî® Desenvolvimento

### Compila√ß√£o

```powershell
# Compilar todos os projetos
dotnet build

# Compilar apenas o servi√ßo
dotnet build ParentalControl.Service\ParentalControl.Service.csproj

# Compilar app de configura√ß√£o
dotnet build ParentalControl.ConfigApp\ParentalControl.ConfigApp.csproj
```

### Testes Locais

O servi√ßo pode ser executado como aplicativo console para testes:

```powershell
cd ParentalControl.Service
dotnet run
```

# Registrar como servi√ßo Windows
sc.exe create ParentalControlService binPath= "c:\ParentalControl\ParentalControl.Service.exe" start= auto

# Iniciar servi√ßo
sc.exe start ParentalControlService

# Parar servi√ßo (apenas admin)
sc.exe stop ParentalControlService

# Remover servi√ßo
sc.exe delete ParentalControlService
```

## Seguran√ßa

### Prote√ß√µes Implementadas
- ‚úÖ Servi√ßo roda como SYSTEM
- ‚úÖ Configura√ß√µes armazenadas em HKLM (requer admin para modificar)
- ‚úÖ APIs nativas do Windows para bloqueio/logout
- ‚úÖ Comunica√ß√£o segura via Named Pipes locais
- ‚úÖ Logging de todas as a√ß√µes

### Prote√ß√µes Pendentes (Instalador)
- üöß ACLs do servi√ßo para impedir stop por usu√°rios padr√£o
- üöß NTFS permissions nos execut√°veis
- üöß Auto-rein√≠cio configurado
- üöß Event Log Source registrado

### Limita√ß√µes Conhecidas
- ‚ö†Ô∏è Administrador pode sempre contornar as prote√ß√µes
- ‚ö†Ô∏è Safe Mode permite bypass (mitiga√ß√£o: senha de BIOS)
- ‚ö†Ô∏è Acesso f√≠sico ao hardware permite bypass

## Logs

O servi√ßo registra eventos no Event Log do Windows:
- **Application Log** ‚Üí Source: "ParentalControl"
- Tipos de eventos: Informa√ß√£o, Aviso, Erro

Visualizar logs:
```powershell
# Event Viewer
eventvwr.msc

# PowerShell
Get-EventLog -LogName Application -Source ParentalControl -Newest 20
```

## Desenvolvimento

### Estrutura de Branches (Sugest√£o)
- `main` - vers√£o est√°vel
- `develop` - desenvolvimento ativo
- `feature/*` - novas funcionalidades

### Conven√ß√µes de C√≥digo
- C# 12 com nullable reference types
- Async/await para opera√ß√µes I/O
- Logging estruturado com ILogger
- Coment√°rios XML em classes p√∫blicas

## Contribui√ß√£o

Para adicionar funcionalidades:
1. Adicionar modelos em `ParentalControl.Core/Models`
2. Implementar l√≥gica no servi√ßo em `ParentalControl.Service`
3. Criar UI no aplicativo de configura√ß√£o
4. Testar com conta de usu√°rio padr√£o

## Licen√ßa

Este projeto est√° licenciado sob **Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)**.

**Resumo:**
- ‚úÖ **Uso livre** - Voc√™ pode usar gratuitamente
- ‚úÖ **Modificar** - Pode alterar e melhorar o c√≥digo
- ‚úÖ **Distribuir** - Pode compartilhar com outras pessoas
- ‚úÖ **Open Source** - C√≥digo aberto e transparente
- ‚ùå **Uso comercial proibido** - N√£o pode vender ou lucrar com este software
- ‚ö†Ô∏è **Atribui√ß√£o obrigat√≥ria** - Deve dar cr√©dito ao autor original
- ‚ö†Ô∏è **Mesma licen√ßa** - Modifica√ß√µes devem usar a mesma licen√ßa

Veja o arquivo [LICENSE](LICENSE) para mais detalhes ou acesse: https://creativecommons.org/licenses/by-nc-sa/4.0/

## Autor

Desenvolvido por **farukzahra** como sistema de controle parental para Windows 11

[![License: CC BY-NC-SA 4.0](https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg)](https://creativecommons.org/licenses/by-nc-sa/4.0/)
